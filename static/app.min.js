document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("chat-container"),t=document.getElementById("user-input"),n=document.getElementById("send-button"),s=(document.getElementById("typing-indicator"),(t,n)=>{const s=document.createElement("div");s.className="message "+(n?"user-message":"assistant-message");if(t.split("\n").filter((e=>e.trim())).forEach((e=>{const t=document.createElement("p");t.textContent=e,s.appendChild(t)})),!n){const e=document.createElement("div");e.className="typing-animation hidden",e.innerHTML='\n                <div class="dot"></div>\n                <div class="dot"></div>\n                <div class="dot"></div>\n            ',s.appendChild(e)}return e.appendChild(s),e.scrollTop=e.scrollHeight,s}),a=s=>{n.disabled=s,t.disabled=s;const a=e.querySelector(".message.assistant-message:last-child");a&&a.querySelector(".typing-animation")?.remove()},o=async()=>{const n=t.value.trim();if(n){s(n,!0),t.value="",a(!0);try{const t=s("",!1);let o=document.createElement("p");t.appendChild(o);let r="";const i=await fetch("/api/chat-stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n})}),d=await i.json();if(!i.ok||d.error)throw a(!1),new Error(d.error||d.detail||"An error occurred while getting a response");const c=i.body.getReader(),l=new TextDecoder;try{for(;;){const{value:n,done:s}=await c.read();if(s)break;const i=l.decode(n);i.split("\n").forEach((n=>{if(n.startsWith("data: ")){const s=n.slice(6);if("[DONE]"===s)return void a(!1);if(s.startsWith("Sources:")){const e=document.createElement("div");return e.className="source-citation",e.textContent=s,void t.appendChild(e)}r+=s+" ",o.textContent=r,e.scrollTop=e.scrollHeight}}))}}catch(e){console.error("Stream reading error:",e),r||(o.textContent=e.message||"Error: Unable to get response"),a(!1)}}catch(t){const n=e.querySelector(".message.assistant-message:last-child");if(n){const e=document.createElement("p");e.textContent=t.message||"Error: Unable to get response",n.appendChild(e)}a(!1)}}};n.addEventListener("click",o),t.addEventListener("keypress",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),o())}))}));