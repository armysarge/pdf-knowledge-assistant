document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("chat-container"),t=document.getElementById("user-input"),n=document.getElementById("send-button"),s=(document.getElementById("typing-indicator"),(t,n)=>{const s=document.createElement("div");s.className="message "+(n?"user-message":"assistant-message");if(t.split("\n").filter((e=>e.trim())).forEach((e=>{const t=document.createElement("p");t.textContent=e,s.appendChild(t)})),!n){const e=document.createElement("div");e.className="typing-animation hidden",e.innerHTML='\n                <div class="dot"></div>\n                <div class="dot"></div>\n                <div class="dot"></div>\n            ',s.appendChild(e)}return e.appendChild(s),e.scrollTop=e.scrollHeight,s}),o=s=>{n.disabled=s,t.disabled=s;const o=e.querySelector(".message.assistant-message:last-child");o&&o.querySelector(".typing-animation")?.classList.toggle("hidden",!s)},r=async()=>{const n=t.value.trim();if(n){s(n,!0),t.value="",o(!0);try{const t=s("",!1);let r=document.createElement("p");t.appendChild(r);let a="";const i=await fetch("/api/chat-stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n})});if(!i.ok){const e=await i.json();throw new Error(e.detail||"An error occurred while getting a response")}const d=i.body.getReader(),c=new TextDecoder;try{for(;;){const{value:n,done:s}=await d.read();if(s)break;const i=c.decode(n);i.split("\n").forEach((n=>{if(n.startsWith("data: ")){const s=n.slice(6);if("[DONE]"===s)return void o(!1);if(s.startsWith("Sources:")){const e=document.createElement("div");return e.className="source-citation",e.textContent=s,void t.appendChild(e)}a+=s+" ",r.textContent=a,e.scrollTop=e.scrollHeight}}))}}catch(e){console.error("Stream reading error:",e),a||(r.textContent="Error: Unable to get response"),o(!1)}}catch(e){s("Error: Unable to get response",!1),console.error("Error:",e),o(!1)}}};n.addEventListener("click",r),t.addEventListener("keypress",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),r())}))}));